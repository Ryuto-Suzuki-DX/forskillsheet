<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!--JS用 ログインユーザID取得-->
    <meta id="loggedInUserId" th:content="${loginUserId}">
    <title>カテゴリー管理</title>
    <link rel="stylesheet" th:href="@{/css/fragment-style.css}">
    <link rel="stylesheet" th:href="@{/css/category/category.css}">
    <script th:src="@{/js/category/category.js}" defer></script>
</head>
<body>
    <!--ヘッダー-->
    <div th:replace="~{fragment/fragment :: header}"></div>

    <div class="category-page-container">
        <!-- 左: 検索フォーム -->
        <div class="category-search-panel">
            <form action="/category/search" th:object="${searchCategoryForm}" method="post">
                <!--権限トークン-->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <button type="submit">検索</button>
                <button type="submit" form="resetForm">リセット</button>

                <label>カテゴリーID：
                    <input type="text" th:field="*{id}" placeholder="カテゴリーID"
                        inputmode="numeric" pattern="[0-9]*"
                        oninput="this.value = this.value.replace(/[０-９]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/[^0-9]/g, '')">
                </label>
                <label>カテゴリー名：
                    <input type="text" th:field="*{name}" placeholder="カテゴリー名">
                </label>
                <label>登録日：
                    <input type="date" th:field="*{createdAtFrom}" placeholder="登録日～">
                    <input type="date" th:field="*{createdAtTo}" placeholder="～登録日">
                </label>
                <label>更新日：
                    <input type="date" th:field="*{updatedAtFrom}" placeholder="更新日～">
                    <input type="date" th:field="*{updatedAtTo}" placeholder="～更新日">
                </label>
            </form>

            <!--リセット用-->
            <form id="resetForm" action="/category/reset" method="post" style="display:none;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            </form>

            <!--管理者(ADMIN)専用ボタン　JS制御付-->
            <div th:if="${loginUserRole == 'ADMIN'}" class="category-actions">

                <!--新規作成ボタン-->
                <form id="newForm" action="/category/new" method="get">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" id="newBtn">新規登録</button>
                </form>

                <!--編集ボタン-->
                <form id="editForm" action="/category/edit" method="get">
                    <input type="hidden" name="categoryId" id="editCategoryId">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" id="editBtn" disabled>編集</button>
                </form>

                <!--削除ボタン-->
                <form id="deleteForm" action="/category/delete" method="post">
                    <input type="hidden" name="categoryId" id="deleteCategoryId">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" disabled id="deleteBtn">削除</button>
                </form>
            </div>
        </div>

        <!-- 右: テーブル -->
        <div class="category-table">
            <table>
                <tr>
                    <th>カテゴリーID</th>
                    <th>カテゴリー名</th>
                    <th>登録日</th>
                    <th>更新日</th>
                </tr>
                <!--JSの選択機能実装-->
                <tr th:each="category : ${categories}" th:data-id="${category.id}">
                    <td th:text="${category.id}"></td>
                    <td th:text="${category.name}"></td>
                    <td th:text="${#temporals.format(category.createdAt, 'yyyy-MM-dd')}"></td>
                    <td th:text="${#temporals.format(category.updatedAt, 'yyyy-MM-dd')}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(categories)}">
                    <td colspan="4">該当するカテゴリーがありません。</td>
                </tr>
            </table>
        </div>
    </div>

    <div th:replace="~{fragment/fragment :: footer}"></div>
</body>
</html>
