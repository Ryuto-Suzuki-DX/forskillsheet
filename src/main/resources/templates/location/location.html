<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
        <!--JS用　ログインユーザID取得-->
    <meta id="loggedInUserId" th:content="${loginUserId}">
    <title>管理場所管理</title>
    <link rel="stylesheet" th:href="@{/css/fragment-style.css}">
    <link rel="stylesheet" th:href="@{/css/location/location.css}">
    <script th:src="@{/js/location/location.js}" defer></script>
</head>
<body>
    <!--ヘッダー-->
    <div th:replace="~{fragment/fragment :: header}"></div>


    <div class="location-page-container">


        <!-- 左: 検索フォーム -->
        <div class="search-panel">
            <form action="/location/search" th:object="${searchLocationForm}" method="post">
                <!--権限トークン-->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit">検索</button>
                <button type="submit" form="resetForm">リセット</button>

                <input type="hidden" th:field="*{id}">
                <label>管理場所名：
                    <input type="text" th:field="*{name}" placeholder="管理場所名">
                </label>
                <label>登録日：
                    <input type="date" th:field="*{createdAtFrom}" placeholder="登録日～">
                    <input type="date" th:field="*{createdAtTo}" placeholder="～登録日">
                </label>
                <label>更新日：
                    <input type="date" th:field="*{updatedAtFrom}" placeholder="更新日～">
                    <input type="date" th:field="*{updatedAtTo}" placeholder="～更新日">
                </label>
            </form>

                        <!--リセット用-->
                        <form id="resetForm" action="/location/reset" method="post" style="display:none;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        </form>


            <!--管理者(ADMIN)専用ボタン　JS制御付-->
            <div th:if="${loginUserRole == 'ADMIN'}" class="location-actions">

                <!--新規作成ボタン-->
                <form id="newForm" action="/location/new" method="get">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" id="newBtn">新規登録</button>
                </form>


                <!--編集ボタン-->
                <form id="editForm" action="/location/edit" method="get">
                    <input type="hidden" name="locationId" id="editLocationId">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" id="editBtn" disabled>編集</button>
                </form>



                <!--削除ボタン-->
                <form id="deleteForm" action="/location/delete" method="post">
                    <input type="hidden" name="locationId"  id="deleteLocationId">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" disabled id="deleteBtn">削除</button>
                </form>
            </div>
        </div>

        <!-- 右: テーブル -->
        <div class="location-table">
            <table>
                <tr>
                    <th>保管場所名</th>
                    <th>登録日</th>
                    <th>更新日</th>
                </tr>
                    <!--JSの選択機能実装-->
                <tr th:each="location : ${locations}" th:data-id="${location.id}">
                    <td th:text="${location.name}"></td>
                    <td th:text="${#temporals.format(location.createdAt, 'yyyy-MM-dd')}"></td>
                    <td th:text="${#temporals.format(location.updatedAt, 'yyyy-MM-dd')}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(locations)}">
                    <td colspan="3">該当する保管場所がありません。</td>
                </tr>
            </table>
        </div>
    </div>

    <div th:replace="~{fragment/fragment :: footer}"></div>
</body>

</html>
