<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
        <!--JS用　ログインユーザID取得-->
    <meta id="loggedInPartyId" th:content="${loginUserId}">
    <title>企業管理</title>
    <link rel="stylesheet" th:href="@{/css/fragment-style.css}">
    <link rel="stylesheet" th:href="@{/css/party/party.css}">
    <script th:src="@{/js/party/party.js}" defer></script>
</head>
<body>
    <!--ヘッダー-->
    <div th:replace="~{fragment/fragment :: header}"></div>

<!------------------------------------------------------------------------------------------------------------>

    <div class="party-page-container">


        <!-- 左: 検索フォーム -->
        <div class="search-panel">
            <form action="/party/search" th:object="${searchPartyForm}" method="post">
                <!--権限トークン-->
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit">検索</button>
                <button type="submit" form="resetForm">リセット</button>

                <input type="hidden" th:field="*{id}">
                <label>企業コード：
                    <input type="text" th:field="*{partyCode}" placeholder="企業コード">
                </label>
                <label>企業名： 
                    <input type="text" th:field="*{name}" placeholder="名前">
                </label>
                <label>住所：
                    <input type="text" th:field="*{address}" placeholder="住所">
                </label>
                <label>詳細：
                    <input type="text" th:field="*{detail}" placeholder="詳細">
                </label>
                <label>注意：
                    <input type="text" th:field="*{attention}" placeholder="注意">
                </label>
                <label>登録日：
                    <input type="date" th:field="*{createdAtFrom}" placeholder="登録日～">
                    <input type="date" th:field="*{createdAtTo}" placeholder="～登録日">
                </label>
                <label>更新日：
                    <input type="date" th:field="*{updatedAtFrom}" placeholder="更新日～">
                    <input type="date" th:field="*{updatedAtTo}" placeholder="～更新日">
                </label>
            </form>

                        <!--リセット用-->
                        <form id="resetForm" action="/party/reset" method="post" style="display:none;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        </form>

<!------------------------------------------------------------------------------------------------------------------->

            <!--管理者(ADMIN)専用ボタン　JS制御付-->
            <div th:if="${loginUserRole == 'ADMIN'}" class="party-actions">

                <!--新規作成ボタン-->
                <form id="newForm" action="/party/new" method="get">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" id="newBtn">新規登録</button>
                </form>


                <!--編集ボタン-->
                <form id="editForm" action="/party/edit" method="get">
                    <input type="hidden" name="partyId" id="editPartyId">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" id="editBtn" disabled>編集</button>
                </form>



                <!--削除ボタン-->
                <form id="deleteForm" action="/party/delete" method="post">
                    <input type="hidden" name="partyId"  id="deletePartyId">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit" disabled id="deleteBtn">削除</button>
                </form>
            </div>
        </div>

        <!-- 右: テーブル -->
        <div class="party-table">
            <table>
                <tr>
                    <th>企業コード</th>
                    <th>企業名</th>
                    <th>住所</th>
                    <th>詳細</th>
                    <th>注意事項</th>
                    <th>登録日</th>
                    <th>更新日</th>
                </tr>
                    <!--JSの選択機能実装-->
                <tr th:each="party : ${parties}" th:data-id="${party.id}">
                    <td th:text="${party.partyCode}"></td>
                    <td th:text="${party.name}"></td>
                    <td th:text="${party.address}"></td>
                    <td th:text="${party.detail}"></td>
                    <td th:text="${party.attention}"></td>
                    <td th:text="${#temporals.format(party.createdAt, 'yyyy-MM-dd')}"></td>
                    <td th:text="${#temporals.format(party.updatedAt, 'yyyy-MM-dd')}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(parties)}">
                    <td colspan="7">該当する企業がありません。</td>
                </tr>
            </table>
        </div>
    </div>

    <div th:replace="~{fragment/fragment :: footer}"></div>
</body>

</html>
